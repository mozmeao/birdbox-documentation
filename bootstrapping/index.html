
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://mozmeao.github.io/birdbox-documentation/bootstrapping/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../local_development/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.8">
    
    
      
        <title>Set up a new site - Project Birdbox documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4b4a2bd9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.356b1318.min.css">
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-gray" data-md-color-accent="green">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#setting-up-a-new-live-site" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Project Birdbox documentation" class="md-header__button md-logo" aria-label="Project Birdbox documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Project Birdbox documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Set up a new site
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue-gray" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mozmeao/birdbox-documentation/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  Set up a new site

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../local_development/" class="md-tabs__link">
        
  
    
  
  Local setup

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../extending/" class="md-tabs__link">
        
  
    
  
  Extending

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../maintenance/" class="md-tabs__link">
        
  
    
  
  Maintenance

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../faqs/" class="md-tabs__link">
        
  
    
  
  FAQs

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../about/" class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../changelog/" class="md-tabs__link">
        
  
    
  
  CHANGELOG

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Project Birdbox documentation" class="md-nav__button md-logo" aria-label="Project Birdbox documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Project Birdbox documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mozmeao/birdbox-documentation/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Set up a new site
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Set up a new site
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="What's on this page?">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      What's on this page?
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#high-level-view" class="md-nav__link">
    High-level view
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#codebase" class="md-nav__link">
    Codebase
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infrastructure-setup" class="md-nav__link">
    Infrastructure setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#application-configuration" class="md-nav__link">
    Application configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sentry-setup" class="md-nav__link">
    Sentry setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slack-notification-setup" class="md-nav__link">
    Slack notification setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sso-setup" class="md-nav__link">
    SSO setup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wagtail-bootstrap-an-initial-site" class="md-nav__link">
    Wagtail: bootstrap an initial site
  </a>
  
    <nav class="md-nav" aria-label="Wagtail: bootstrap an initial site">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-an-initial-admin-user" class="md-nav__link">
    Add an initial admin user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-new-root-page" class="md-nav__link">
    Set new root page
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-footer-and-nav" class="md-nav__link">
    Enable footer and nav
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-other-users" class="md-nav__link">
    Add other users
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wagtail-lay-in-content" class="md-nav__link">
    Wagtail: Lay in content
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go-live" class="md-nav__link">
    Go live
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../local_development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Local setup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../extending/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extending
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../maintenance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maintenance
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../faqs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CHANGELOG
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="setting-up-a-new-live-site">Setting up a new live site<a class="headerlink" href="#setting-up-a-new-live-site" title="Permanent link">&para;</a></h1>
<p>These are the end-to-end steps required to set up a new site using Birdbox.</p>
<h2 id="high-level-view">High-level view<a class="headerlink" href="#high-level-view" title="Permanent link">&para;</a></h2>
<p>The steps are:</p>
<ol>
<li>Fork the core Birdbox repo</li>
<li>Set up infrastructure - servers and hostname, plus deployment pipeline</li>
<li>Set up/tune site-specific configuration</li>
<li>Set up basic/core site ready for content creation</li>
<li>Lay in content and QA</li>
<li>Go live!</li>
</ol>
<h2 id="codebase">Codebase<a class="headerlink" href="#codebase" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Go to <a href="https://github.com/mozmeao/birdbox/">https://github.com/mozmeao/birdbox/</a> and fork the repo. When naming the forked repo, <strong>do not call it just <code>birdbox</code></strong>, but please prefix it with <code>birdbox-</code>. In this documentation we'll use <code>birdbox-newsite</code> as our example name.</p>
</li>
<li>
<p>Add appropriate team access to the forked repo, so that colleagues can manage it and you get appropriate alerts: <code>https://github.com/ORG_NAME/birdbox-newsite/settings/access</code></p>
</li>
<li>
<p>Enable Dependabot security updates at <code>https://github.com/ORG_NAME/birdbox-newsite/settings/security_analysis</code></p>
</li>
<li>
<p>Enable GH Actions at <code>https://github.com/ORG_NAME/birdbox-newsite/actions/</code>. This is not needed for deployments, but runs workflows like unit tests, for extra protection</p>
</li>
<li>
<p>Protect the <code>main</code> branch in the repo at <code>https://github.com/ORG_NAME/birdbox-newsite/settings/branches</code></p>
</li>
</ol>
<h2 id="infrastructure-setup">Infrastructure setup<a class="headerlink" href="#infrastructure-setup" title="Permanent link">&para;</a></h2>
<p>The infrastructure we need comprises:</p>
<ol>
<li>A Kubernetes service for each the three environments in Mozilla's standard pattern: <code>dev</code>, <code>stage</code> and <code>production</code>.</li>
<li>A deployment pipeline that takes a commit from the application repo and builds a Docker container image from it, and pushes that out to Kubernetes to serve.</li>
<li>Domain/hostname setup</li>
<li>Monitoring</li>
<li>Alerting and error logging</li>
</ol>
<p>Don't worry, though - as much of this as possible is repeatable, or straightfoward to do.</p>
<ul>
<li>
<p>The k8s service and deployment pipeline steps (items 1 and 2 above) are well documented by SRE and live in <a href="https://mozilla-hub.atlassian.net/wiki/spaces/EN/pages/495223137/Birdbox+infra+setup+notes">this internal documentation</a>. At the moment, the majority of this work still needs to be done by a member of the SRE Green team, but as much as possible is already within reach of the MEAO backend team.</p>
</li>
<li>
<p>Domain setup (Item 3) has to be handled by SRE.</p>
</li>
<li>
<p>Monitoring (item 4) can be set up by a developer or SRE.</p>
</li>
<li>
<p>Alerting (Item 5) can be set up by a developer and is mentioned in the <a href="#configuration-setup">Configuration setup</a> step</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Key action</p>
<p><em>Currently, for Steps 1-4, you should request this work via a JIRA ticket</em>: hit the Create button <a href="https://mozilla-hub.atlassian.net/jira/software/c/projects/SE/issues/">here</a>.</p>
<p>Use this <a href="../sre_template_setup_message/">template message</a> to request setup, which makes it clear it is a Birdbox-based project.</p>
<p>When SRE has set everything up, please add a secure note to the MEAO password vault containing the a) names of the services created e.g. <code>newsite-dev</code>, b) the projects they are in and c) the clusters they are running on. You'll need them a lot in the near future.</p>
</div>
<ul>
<li>Step 5 (Monitoring) can be done as part of the configuration step.</li>
</ul>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>There are a few areas you'll need to configure:</p>
<ul>
<li>Application-specific config</li>
<li>Sentry config</li>
<li>Slack notifications config</li>
<li>SSO config</li>
</ul>
<h3 id="application-configuration">Application configuration<a class="headerlink" href="#application-configuration" title="Permanent link">&para;</a></h3>
<p>As part of the infrastructure setup (above), new configuration files will have been added to a private configuration repo owned by Mozilla IT: <a href="https://github.com/mozilla-it/webservices-infra/">https://github.com/mozilla-it/webservices-infra/</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A developer will need appropriate access to the <code>mozilla-it</code> organisation.</p>
<p>Commits made to webservices-infra <a href="../faqs/#how-do-i-sign-commits">need to be signed</a> in order to be merged.</p>
</div>
<p>In that repo you will find a folder for your project - e.g. <code>birdbox-newsite</code> or just <code>newsite</code>.</p>
<p>In that folder, there will be several configuration files. Most of them you do not need to edit, but the ones related to environment variables may need adding to as part of configuration. Here are the files and example contents for a Birdbox-based project</p>
<p>Each environment will have config specific to it, which must go in a specific file:</p>
<ul>
<li><code>newsite/k8s/newsite/values-dev.yaml</code> - config values for the deployed Dev site/service</li>
<li><code>newsite/k8s/newsite/values-stage.yaml</code> - config values for the deployed Staging site/service</li>
<li><code>newsite/k8s/newsite/values-prod.yaml</code> - config values for the deployed Production site/service</li>
</ul>
<p><a href="../tenant_config_examples/values-env-specific/">Required contents for the env-specific files</a>.</p>
<ul>
<li><code>newsite/k8s/newsite/values.yaml</code> - shared/fallback values if none is specified in one of the above files.</li>
</ul>
<p><a href="../tenant_config_examples/values-excerpt/">Required contents for the shared file</a>.</p>
<ul>
<li><code>newsite/k8s/newsite/deployment.yaml</code> - this file specifies config for all deployments, readinging from the relevant <code>values-*.yaml</code> file and the<code>values.yaml</code> files. If you add a value from <code>values.*yaml</code> you should amend the this file, too in order to use it.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Don't forget</p>
<p>After setup, review the <code>env:</code> section of the <code>deployment.yaml</code> to be sure that it is definitely pulling in all of the variables set in <code>values*.yaml</code> <em>and that the env var's names exactly match the corresponding names used in <code>birdbox/settings/base.py</code> in the main Birdbox codebase</em>.</p>
</div>
<h3 id="sentry-setup">Sentry setup<a class="headerlink" href="#sentry-setup" title="Permanent link">&para;</a></h3>
<p>In the example <code>values-*.yaml</code> file above, there is reference to a sentry_dsn and csp_reporting_endpoint. Both of these you can get by setting up a new Sentry project (one for each of dev, stage and prod):</p>
<ul>
<li>Sign into Sentry via Mozilla's SSO Dashboard</li>
<li>Make a new Team at <a href="https://mozilla.sentry.io/settings/teams/">https://mozilla.sentry.io/settings/teams/</a> and call it something obvious like the domain of the site you're making (e.g. #future-mozilla-org).</li>
<li>Add appropriate people to the team - developers and admins currently workign on the project</li>
<li>For each of Dev, Stage and Prod, make a new project, called something obvious - e.g. <code>birdbox-newsite-mozilla-org-dev</code>. Make sure the Team you made has access to each new Project.</li>
<li>Get the Sentry DSN URI from <code>https://mozilla.sentry.io/settings/projects/PROJECT_SLUG/keys/</code></li>
<li>Get the Report URI from <code>https://mozilla.sentry.io/settings/projects/PROJECT_SLUG/security-headers/</code></li>
</ul>
<p>Once you have these two values, you will need to make a PR against <a href="https://github.com/mozilla-it/webservices-infra/">https://github.com/mozilla-it/webservices-infra/</a> to add them to relevant <code>values*.yaml</code> files. This need approval from a member of <a href="https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/about-code-owners">CODEOWNERS</a> before you can merge it.</p>
<h3 id="slack-notification-setup">Slack notification setup<a class="headerlink" href="#slack-notification-setup" title="Permanent link">&para;</a></h3>
<p>You can set up deployment notifications in Mozilla Slack. To do this, you'll need to tweak some config in the new deployment repo created by Mozilla SRE - see the documentation above.</p>
<p><strong>Slack steps:</strong></p>
<ol>
<li>Make a new, public channel - e.g. <code>#newsite-notify</code></li>
<li>Right-click on the channel in the Slack sidebar and <code>View Channel Details</code>.</li>
<li>From the bottom of that modal, copy the Channel ID.</li>
</ol>
<p><strong>Deployment repo steps:</strong></p>
<ol>
<li>Check out the relevant deployment repo.</li>
<li>In the <code>`.github/workflows/</code> directory there are YAML files for Dev, Stage and Prod</li>
<li>Each of these files has an <code>env</code> key called <code>SLACK_CHANNEL_ID</code>. It will (likely) be set to a single ID for now - that's SRE's own notification room. You can make the deployment repo send notifications to multiple rooms by switching the value it a comma-separate list of room IDs:</li>
</ol>
<p>From:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>SLACK_CHANNEL_ID: FAKE1234567
</span></code></pre></div>
<p>To:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>SLACK_CHANNEL_ID: &quot;FAKE1234567,FAKE7766554&quot;
</span></code></pre></div>
<h3 id="sso-setup">SSO setup<a class="headerlink" href="#sso-setup" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The only way to sign in to a deployed Birdbox-based site is via Mozilla SSO.</p>
</div>
<p>SSO is managed by the IAM team, and you can request setup via JIRA</p>
<ul>
<li>Use this <a href="../template_requests/sso_setup_request_template/">template message</a>...</li>
<li>...to open an Issue on <a href="https://mozilla-hub.atlassian.net/jira/software/c/projects/IAM/issues">this board</a></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Maintain least privilege</p>
<p>The template above has a space to list Mozilla staff who should be the <em>initial</em> curators of a particular access group. <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">This should be kept as small/tight as possible</a>. In particular, only give someone access to Production if they absolutely need it to do their job.</p>
<p>It's always possible add or remove access-group members later on.</p>
</div>
<p>Once that request is done, there are three steps left:</p>
<ol>
<li>Get the OIDC credentials into the relevant environments - explained <a href="../faqs/#how-do-i-edit-secrets">here</a></li>
<li>Bootstrap an admin user for yourself - this is covered below</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Don't forget</p>
<p>Birdbox does not support automatic user-account creation for someone logging in via SSO, even if they have an @mozilla.com identity - they need to be created first.</p>
<p>Only users who already exist in the Wagtail admin as a User will be allowed to log in.</p>
</div>
<h2 id="wagtail-bootstrap-an-initial-site">Wagtail: bootstrap an initial site<a class="headerlink" href="#wagtail-bootstrap-an-initial-site" title="Permanent link">&para;</a></h2>
<p>Now comes the stage where you can start adding pages and content into the site, ahead of go-live.</p>
<div class="admonition note">
<p class="admonition-title">Moving content between sites</p>
<p>If you have Dev, Stage and Prod sites and you want them all to have similar content, you'll need to set them all up the same way.</p>
<p>You can either duplicate the same manual effort across all three, or add content to one of them and then copy it to the other two. That copying process is currently pretty hands-on, but there are <a href="../faqs/#how-to-i-copy-data-between-devstageprod-sites">some tips here</a>.</p>
</div>
<h3 id="add-an-initial-admin-user">Add an initial admin user<a class="headerlink" href="#add-an-initial-admin-user" title="Permanent link">&para;</a></h3>
<p>The system starts with no users, and you can't log in to create users unless a matching account already exists. So, first you have to create one via the CLI.</p>
<p>On each deployed environment - dev, stage and prod, do this:</p>
<p>1) Shell into a running pod - <a href="../faqs/#how-do-i-shell-into-a-running-pod">see here if you need help</a></p>
<p>2) Run <code>python birdbox/manage.py createsuperuser --email=YOURIDENTITY@mozilla.com --username=YOURIDENTITY@mozilla.com --no-input</code>. It is crucial that <code>YOURIDENTITY@mozilla.com</code> matches your Mozilla SSO email address.</p>
<div class="admonition note">
<p class="admonition-title">No password? No problem</p>
<p>The line above will create a new admin user but with no password. Normally in Django that would block authentication until a password it set, but because Mozilla SSO does not need a password (and is the only way to authenticate), this is fine.</p>
</div>
<p>3) You will now be able to sign in at <code>/admin/</code> using your Mozilla SSO identity</p>
<h3 id="set-new-root-page">Set new root page<a class="headerlink" href="#set-new-root-page" title="Permanent link">&para;</a></h3>
<p>Wagtail comes pre-set-up with a default "Welcome to your Wagtail site!" page at the site's root of <code>/</code>. We need to replace this a new <code>HomePage</code>:</p>
<ol>
<li>Go to <code>/admin/pages/</code> and click the "Add Child Page" button.</li>
<li>The page will be titled "Create a page in Root". Select "Home Page" and add an initial title for the page, plus add something temporary in the Content field such as an Article Block. This will allow you to save the page - use the Publish option from the expanding save button at the bottom of the page.</li>
<li>Check you can see your new page listed alongside the Wagtail welcome page. Note how the Wagtail welcome page has a globe icon beside it's name: this indicates it is the root page for the site.</li>
<li>From the Wagtail menu go to <code>Settings &gt; Sites</code> towards the bottom of the <code>Settings</code> sub-menu)</li>
<li>If there is one site listed, click it to edit it. If not, click the <code>Add a site</code> button.</li>
<li>Set the fields appropriately <em>including changing the root page of the site to the new Home Page you just made</em>. Mark it as the default site. Save.</li>
<li>Go to <code>/</code> and you should see your new skeleton homepage instead</li>
<li>We no longer need the Welcome page. Go back to <code>/admin/pages/</code>, hover over the Welcome page and click the <code>...</code> menu. Select <code>Delete</code> and delete the page.</li>
</ol>
<h3 id="enable-footer-and-nav">Enable footer and nav<a class="headerlink" href="#enable-footer-and-nav" title="Permanent link">&para;</a></h3>
<h4 id="footer">Footer<a class="headerlink" href="#footer" title="Permanent link">&para;</a></h4>
<p>The footer can be manually edited via <code>Settings &gt; Configure footer</code>, where links are grouped into columns and the small links are handled as rich text.</p>
<p>If you want to quickly add a Mozilla.org-like footer to a site, you can <a href="../faqs/#how-do-i-shell-into-a-running-pod">shell into a pod</a> for the relevant environment and run: <code>python birdbox/manage.py bootstrap_footer --commit</code></p>
<h4 id="nav">Nav<a class="headerlink" href="#nav" title="Permanent link">&para;</a></h4>
<p>To enable the navigation bar, go to <code>Settings &gt; Site settings</code>. Here's what the options do:</p>
<p><strong>Show nav bar on site?</strong>
Whether or to have the Nav shown at all</p>
<h4 id="navigation-theme">Navigation theme<a class="headerlink" href="#navigation-theme" title="Permanent link">&para;</a></h4>
<p>Dark or light theme. Most Mozilla-brand sites use Dark</p>
<h4 id="automatically-generate-nav-from-page-heirarchy">Automatically generate nav from page heirarchy?<a class="headerlink" href="#automatically-generate-nav-from-page-heirarchy" title="Permanent link">&para;</a></h4>
<p>If this is enabled, pages that are configured to appear in a Nav will do so, based on the page tree they are part of.</p>
<p>To make a page appear in the nav, go to the <code>Settings</code> tab for that page, and tick the <code>Show in Menus</code> checkbox then republish the page. There are other navigation-related fields you may want to also populate first.</p>
<h4 id="cta-button">CTA button<a class="headerlink" href="#cta-button" title="Permanent link">&para;</a></h4>
<p>If you want a button in the right-side of the nav, this is where you set that up</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>After making any changes to Site Settings, remember to Save the settings.</strong></p>
<p>The changes are immediately reflected in the site - there is no concept of Preview with Site Settings.</p>
</div>
<h3 id="add-other-users">Add other users<a class="headerlink" href="#add-other-users" title="Permanent link">&para;</a></h3>
<p>Now the site is almost ready to lay in content, it might be a good time to allow others to add that content. See the <a href="../adding_users_to_wagtail/">specific notes for adding users</a>.</p>
<p>Alternatively, you may wish to lay in all the initial content youself before "handing over the keys" - this is also fine.</p>
<h2 id="wagtail-lay-in-content">Wagtail: Lay in content<a class="headerlink" href="#wagtail-lay-in-content" title="Permanent link">&para;</a></h2>
<p>Build out the tree of pages needed in the site, using the page types available in Birdbox. Each page type has a certain set of components/fields/blocks available, as a form of light 'guard rails' to avoid pages becoming a soup of varied components.</p>
<div class="admonition note">
<p class="admonition-title">Pick appropriate page types</p>
<p>There are some that are reserved for certain teams (e.g. pages starting <code>Innovations*</code> are for the Innovations team, <code>ProtocolTestPage</code> is reserved for core Birdbox testing) but otherwise you can use whatever page types you want.</p>
<p>In the future, we will <a href="https://github.com/mozmeao/birdbox/issues/213">support a way to limit which page types are available</a> purely via configuration.</p>
</div>
<p>The best way to get familiar with how to add content via Wagtail is to read the official <a href="https://guide.wagtail.org/en-latest/">Editor Guide</a>, which focuses on the CMS editing experience, rather than code. This documentation can also be recommended to the Mozilla colleagues who will be managing content on the site.</p>
<h2 id="go-live">Go live<a class="headerlink" href="#go-live" title="Permanent link">&para;</a></h2>
<p>Once you are sure all of the content on the production site is correct, all that remains is to ask SRE to point the public domain to the same service that is serving the internal production domain.</p>
<p>Things to check before you go live:</p>
<ul>
<li>Check the site record (<code>Settings &gt; Site</code>) has the correct hostname in it</li>
<li>Check content for any links to the internal hostname, rather than the public-facing hostname</li>
</ul>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Home
              </div>
            </div>
          </a>
        
        
          
          <a href="../local_development/" class="md-footer__link md-footer__link--next" aria-label="Next: Local setup">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Local setup
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      © Copyright 2011-2024, Mozilla
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/mozmeao/birdbox-documentation/issues/" target="_blank" rel="noopener" title="Report a problem with this documentation" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M256 0c53 0 96 43 96 96v3.6c0 15.7-12.7 28.4-28.4 28.4H188.4c-15.7 0-28.4-12.7-28.4-28.4V96c0-53 43-96 96-96zM41.4 105.4c12.5-12.5 32.8-12.5 45.3 0l64 64c.7.7 1.3 1.4 1.9 2.1 14.2-7.3 30.4-11.4 47.5-11.4H312c17.1 0 33.2 4.1 47.5 11.4.6-.7 1.2-1.4 1.9-2.1l64-64c12.5-12.5 32.8-12.5 45.3 0s12.5 32.8 0 45.3l-64 64c-.7.7-1.4 1.3-2.1 1.9 6.2 12 10.1 25.3 11.1 39.5H480c17.7 0 32 14.3 32 32s-14.3 32-32 32h-64c0 24.6-5.5 47.8-15.4 68.6 2.2 1.3 4.2 2.9 6 4.8l64 64c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0l-63.1-63.1c-24.5 21.8-55.8 36.2-90.3 39.6V240c0-8.8-7.2-16-16-16s-16 7.2-16 16v239.2c-34.5-3.4-65.8-17.8-90.3-39.6l-63 63c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l64-64c1.9-1.9 3.9-3.4 6-4.8C101.5 367.8 96 344.6 96 320H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h64.3c1.1-14.1 5-27.5 11.1-39.5-.7-.6-1.4-1.2-2.1-1.9l-64-64c-12.5-12.5-12.5-32.8 0-45.3z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotation", "content.code.copy", "content.tabs.link", "navigation.footer", "navigation.path", "navigation.sections", "navigation.expand", "navigation.tabs", "navigation.top", "search.highlight", "search.suggest", "toc.integrate"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.81fa17fe.min.js"></script>
      
    
  </body>
</html>